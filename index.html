<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hyperbeam VM</title>
<style>
body { margin:0; font-family: Arial,sans-serif; display:flex; flex-direction:column; height:100vh; background:#1e1e1e; color:#fff; }
header { padding:10px 20px; background:#282828; display:flex; flex-direction:column; }
#buttons { display:flex; gap:10px; align-items:center; margin-top:5px; }
button { padding:6px 12px; background:#4CAF50; border:none; border-radius:5px; color:white; cursor:pointer; }
button:hover { background:#45a049; }
#info { font-size:12px; color:#ccc; margin-top:5px; word-break:break-all; }
iframe { flex:1; border:none; width:100%; }
</style>
</head>
<body>

<header>
  <div id="buttons">
    <button id="newVM">New VM</button>
    <span id="status">Loading...</span>
  </div>
  <div id="info">Fetching VM info...</div>
</header>

<iframe id="vm"></iframe>

<script>
const WORKER_URL = "https://your-worker-url.workers.dev/"; // replace with your Worker URL
const iframeEl = document.getElementById('vm');
const infoEl = document.getElementById('info');
const statusEl = document.getElementById('status');

let currentVM = null; // store current VM info

async function spawnVM() {
  statusEl.textContent = "Loading VM...";
  infoEl.textContent = "Fetching VM info...";
  
  // If we already have a VM, reuse it
  if (currentVM && currentVM.embed_url) {
    iframeEl.src = currentVM.embed_url;
    statusEl.textContent = "VM Loaded (reused)!";
    infoEl.innerHTML = formatInfo(currentVM);
    return;
  }

  try {
    const res = await fetch(WORKER_URL);
    const data = await res.json();
    
    if (data.error) {
      infoEl.textContent = "Error: " + JSON.stringify(data.error);
      statusEl.textContent = "VM Error";
      return;
    }

    currentVM = data; // save VM info
    iframeEl.src = data.embed_url;
    statusEl.textContent = "VM Loaded!";
    infoEl.innerHTML = formatInfo(data);

  } catch(err) {
    infoEl.textContent = "Error: " + err.toString();
    statusEl.textContent = "VM Error";
  }
}

function formatInfo(data) {
  return `
    <strong>Embed URL:</strong> <a href="${data.embed_url}" target="_blank">${data.embed_url}</a><br>
    <strong>Session ID:</strong> ${data.session_id || 'N/A'}<br>
    <strong>Admin Token:</strong> ${data.admin_token || 'N/A'}
  `;
}

// Spawn first VM on load
spawnVM();

// Button spawns a new VM (forces new curl)
document.getElementById('newVM').addEventListener('click', ()=>{
  currentVM = null; // clear old VM
  spawnVM();
});
</script>

</body>
</html>
